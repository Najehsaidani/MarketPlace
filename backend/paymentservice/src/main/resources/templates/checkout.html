<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Checkout</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h1>Checkout with <span th:text="${seller.name}"></span></h1>
                </div>
                <div class="card-body">
                    <p>Product: Handmade Bag â€” $20</p>
                    <button id="payBtn" class="btn btn-primary btn-lg">Pay with Stripe</button>
                    <div class="mt-3">
                        <a href="/" class="btn btn-secondary">Back to Home</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const stripe = Stripe(/*[[${publicKey}]]*/);
    const payButton = document.getElementById('payBtn');

    payButton.addEventListener('click', async () => {
        // Create PaymentIntent on backend
        const response = await fetch('/create-payment-intent/' + /*[[${seller.id}]]*/ + '?amount=2000', { // $20
            method: 'POST'
        });
        const clientSecret = await response.text();

        const result = await stripe.confirmCardPayment(clientSecret, {
            payment_method: {
                card: {
                    // use Stripe Elements in production
                },
            }
        });

        if (result.error) {
            alert(result.error.message);
        } else if (result.paymentIntent.status === 'succeeded') {
            window.location.href = '/success-payment';
        }
    });
</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>